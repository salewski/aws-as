<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>aws-as by salewski</title>

    <link rel="stylesheet" href="stylesheets/styles.css">
    <link rel="stylesheet" href="stylesheets/github-light.css">
    <meta name="viewport" content="width=device-width">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="wrapper">
      <header>
        <h1>aws-as</h1>
        <p>Easily switch between cached sets of AWS STS credentials (command line tools)</p>

        <p class="view"><a href="https://github.com/salewski/aws-as">View the Project on GitHub <small>salewski/aws-as</small></a></p>

        <ul>
          <li class="li-tarball-link"><span id="lbl-latest-tarball"><strong>Latest (released <code>2020-09-14</code>):</strong></span><br><a href="downloads/aws-as-0.2.0.tar.gz"><code>aws-as-0.2.0.tar.gz</code></a></li>
        </ul>

        <ul>
<!--
          <li><a href="https://github.com/salewski/aws-as/zipball/master">Download <strong>ZIP File</strong></a></li>
          <li><a href="https://github.com/salewski/aws-as/tarball/master">Download <strong>TAR Ball</strong></a></li>
-->

          <li class="li-downloads-archive-link"><a href="downloads/"><strong>Downloads Archive</strong></a></li>

<!--
          <li><a href="https://github.com/salewski/aws-as">View On <strong>GitHub</strong></a></li>
-->
        </ul>

      </header>
      <section>
        <h1>
<a id="welcome-to-aws-as" class="anchor" href="#welcome-to-aws-as" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>'aws-as' project home page</h1>

<p><em>Built on top
of <strong><a href="https://github.com/99designs/aws-vault">aws-vault</a></strong>. Allows
fast and easy switching
between <strong><a href="https://aws.amazon.com/cli/">aws-cli</a></strong>
<a href="https://docs.aws.amazon.com/cli/latest/userguide/cli-configure-profiles.html">profiles</a>,
and running user-supplied commands in the context of what we call <strong>"the
in-effect profile"</strong>. Also provides features for <strong>"hoisting"</strong>
the <strong>'AWS_*'</strong> credential variables
(<strong><code>AWS_ACCESS_KEY_ID</code></strong>, <strong><code>AWS_SECRET_ACCESS_KEY</code></strong>,
and <strong><code>AWS_SESSION_TOKEN</code></strong>) into the current shell process
and otherwise manipulating them (export, unexport, unset, ...).</em></p>

<p>The <code>aws-as</code> project provides a collection of tools for
switching between cached sets of temporary AWS STS credentials for IAM Users
and/or Roles when working at the command line.</p>

<p>The provided <strong><code>aws-as</code></strong>
and <strong><code>aagg</code></strong> commands work as a layer on top
of <a href="https://github.com/99designs/aws-vault">aws-vault</a>
(from <a href="https://99designs.com/">99designs</a>), so work with your
existing <a href="https://docs.aws.amazon.com/cli/latest/userguide/cli-chap-configure.html"><code>aws-cli</code>
configuration</a>. The provided tooling works alongside
of <code>aws-vault</code> it to augment its capabilities.</p>

<!-- TOC -->
<h2><a id="sec-contents">Contents:</a></h2>
<ul>
  <li><a href="#sec-three-layers">Three Layers</a></li>
  <li><a href="#sec-aws-cli-and-mfa">aws-cli and MFA</a></li>
  <li><a href="#sec-prerequisites">Prerequisities</a></li>
  <li><a href="#sec-installation">Installation</a></li>
  <li><a href="#sec-post-installation">Post-installation</a></li>
  <li><a href="#sec-usage">Usage</a></li>
  <li><a href="#sec-faq">FAQ</a></li>
<!--  <li><a href="#sec-aws-vault-quickstart">aws-vault quickstart</a></li> -->
  <li><a href="#sec-license">License</a></li>
</ul>

<h2><a id="sec-three-layers">Three Layers</a></h2>

<div class="logical-paragraph">
<p>There are three layers of tooling involved:</p>
<ol>
  <li><p><strong><code>aws-cli</code>:</strong> This defines the way you
         manage various "profiles" for your AWS IAM Users and Roles to
         assume. If you have used AWS from the command line, you no doubt
         already have this. The '<code>aws</code>' program is not used
         directly by <code>aws-as</code>, but its configuration (or one
         that looks it) must be present in order for the other two layers
         to work.</p></li>

  <li><p><strong><code>aws-vault</code>:</strong> This tool is used directly
         by <code>'aws-as'</code> to cause temporary AWS STS ("Security Token
         Service") credentials to be cached within <code>aws-vault</code>, and in
         some circumstances to have <code>aws-vault</code> run a user-supplied
         command in a subprocess with a particular set of AWS credentials
         in-effect.</p></li>

  <li><p><strong><code>aws-as</code>:</strong> Maintains a notion of "the currently
         in-effect aws-cli profile", and the
         provided <strong>'<code>aws-as</code>'</strong> command allows quickly
         switching between various profiles. The
         provided <strong>'<code>aagg</code>'</strong> command makes it simple to
         run a command in the the context of the in-effect profile.</p></li>
</ol>
</div>


<p>The <code>aws-as</code> programs treat the aws-cli configuration as a
read-only resource, and never attempt to modify it in any way. In
fact, <code>aws-as</code> leverages the information in your aws-cli config
only indirectly, via <code>aws-vault</code>.</p>

<p>Because it leverages <code>aws-vault</code>, the <code>aws-as</code>
command supports the easy use of MFA for both Role and non-Role
aws-cli profiles. Temporary credentials are cached (by <code>aws-vault</code>)
and reused until they expire. Expired credentials are detected prior
to use and new temporary credentials are obtained as needed. Re-authentication
(with MFA, if necessary) is performed when needed.</p>


<h2><a id="sec-aws-cli-and-mfa">aws-cli and MFA</a></h2>

<p>If you have used '<code>aws-cli</code>' directly you may be familiar
with the way it <em>only</em> sometimes caches temporary credentials. In
particular, when you have a profile defined for a role to be assumed, a
set of temporary credentials is cached when you perform an activity that
using the profile. On the other hand, if you authenticate with MFA by
invoking the 'sts get-session-token' subcommand, then aws-cli <em>does
not</em> cache those temporary credentials.</p>

<p>In contrast, when '<code>aws-vault</code>' needs to authenticate using a profile,
it <em>always</em> caches the temporary credentials thus obtained (unless you
go out of your way to ask it to not do so). This is a critical usability
enhancement, especially when MFA is required, and one of the prime reasons
'<code>aws-as</code>' is built on top of '<code>aws-vault</code>'. (Before
<code>aws-as</code> incorporated the use <code>aws-vault</code>, it had an internal
home-grown caching scheme that provided this feature, but in a less secure (and less
performant) way than <code>aws-vault</code>.) Without this feature working for all
profiles, switching between profiles would be extremely tedious, with the user having
to continually re-enter MFA token codes. Fortunately, <code>aws-vault</code> makes it
is a solved problem.</p>

<p>In order for the caching to work, however, <code>aws-vault</code> supports an
extended use of the <strong>'<code>mfa_serial</code>'</strong> key in the user's
aws-cli profile configurations. In particular, it may be applied to non-Role profiles
and will be honored by <code>aws-vault</code> as implying that MFA-based
authentication must be done when using the profile. We say that this is "extended
use" because it is usage not recognized by <code>aws-cli</code>;
<code>aws-cli</code> only recognizes the <code>'mfa_serial'</code> setting in
Role-based profiles (those with a <code>'role_arn'</code> setting defined), and will
prompt the user for the MFA token when authenticating when assuming the role.</p>

<p>Why are we talking about this here?</p>

<a id="explanation-mfa-serial"></a>
<p>This is important for effective use of MFA when using <code>aws-as</code> to
switch between different profiles. <strong>You will want to add
'<code>mfa_serial</code>' settings to your aws-cli profiles, where needed, even if
they are not Role-based profiles. The '<code>aws</code>' command will not honor them,
but it also will not complain that they are there. They <em>will</em> be used
by <code>aws-vault</code> (and so, indirectly, by <code>aws-as</code>, as
well).</strong></p>


<h2><a id="sec-prerequisites">Prerequisities</a></h2>
<div class="logical-paragraph">
<p>
The <strong><code>aws-as</code></strong> is fairly light on
prerequisites -- mostly, you just need any modern Unix-like system
(GNU/Linux, OpenBSD/FreeBSD/NetBSD/..., macOS, ...). Two particular
prerequisites are:</p>
<ul>
    <li><p><strong><code>bash >= 4.x</code></strong>
        (<a href="http://ftp.gnu.org/gnu/bash/">Releases</a>) <a href="https://www.gnu.org/software/bash/">Bash</a>,
        the <a href="https://www.gnu.org/" alt="www.gnu.org">GNU</a>
        Project's "Bourne Again SHell". A version greater than or equal
        to 4.x is required because the associative array feature
        introduced in that version is used. At the time of writing
        (2020-09), the current version of Bash is 5.0.</li>

    <li><p><strong><code>aws-vault >= 6.0.0</code></strong> <a href="https://github.com/99designs/aws-vault/releases">(Releases)</a></p>
        <p>Version 6.0.0 (or newer) is required because that is the version
        in which the '<code>aws-vault clear</code>' command was
        introduced. That command removes short-term credentials from
        the <code>aws-vault</code> cache; that feature is used by the
        '<code>aws-as --clear-creds</code>' command.</p>

<!--
        <p><em>If you are new to <code>aws-vault</code> you may be
        interested in the <a href="#sec-aws-vault-quickstart">"aws-vault
        quickstart"</a> section below.</em></p></li>
-->
</ul>
<p>
In general, the provided '<code>configure</code>' script
(see <a href="#sec-installation">"Installation"</a> section below) will
probe the system for needed prerequisites, so you'll know you've got
everything needed if it does not complain about anything
missing.
<em>[But see also <a href="https://github.com/salewski/aws-as/issues/34">issue #34</a>. --Editor]</em>
</p>
</div>


<h2><a id="sec-installation">Installation</a></h2>
<p>
Installation should be as simple as:</p>
<pre>
    $ <strong>./configure</strong>   # add a --prefix=path/to/some/location to install
                    # someplace other than beneath /usr/local (the default)
    $ <strong>make</strong>
    $ <strong>make check</strong>    # optional, but encouraged
    $ <strong>make install</strong>
</pre>


<h2><a id="sec-post-installation">Post-installation</a></h2>
<div class="logical-paragraph">
<ul>

  <li><p><em>(Required).</em>
      Ensure <strong><code>aws-vault</code></strong> has a "backend"
      configured. This will only be necessary for
      first-time <code>aws-vault</code> users. For users who have an
      existing <code>aws-vault</code> configuration, there is nothing
      new required here; just move on to the next step.</p></li>

  <li><p><em>(Optional).</em> If you use multi-factor authentication
      (MFA) to access some or all of your non-Role AWS profiles, you may
      need to add <strong>'<code>mfa_serial</code>'</strong> settings to
      your <code>aws-cli</code>
      configuration. See <a href="#explanation-mfa-serial">our
      explanation above</a>.
      </p></li>

</ul>
<p>With '<code>aws-vault</code>' (and where needed, MFA) configured, you
are ready to start using <strong>'<code>aws-as</code>'</strong>.</p>
</div>


<h2><a id="sec-usage">Usage</a></h2>

<!-- subsection toc -->

<a id="subsec-contents"></a>
<h3>Usage contents:</h2>
<ul>
  <li><a href="#subsec-walkthrough">Walkthrough</a></li>
  <li><a href="#subsec-aws-profile-is-not-used">AWS_PROFILE is not used</a></li>
  <li><a href="#subsec-no-aws-variables-are-set-by-default">No AWS_* variables are set (by default)</a>
      <ul>
        <li><a href="#subsec-how-it-works">How it works</a></li>
        <li><a href="#subsec-but-aws-vars-in-the-shell-env-can-be-useful">"But AWS_* vars in the shell env can be useful..." (hoisting)</a></li>
        <li><a href="#subsec-exporting-the-aws-variables">Exporting the AWS_* variables</a></li>
        <li><a href="#subsec-unexporting-the-aws-variables">Unexporting the AWS_* variables</a></li>
        <li><a href="#subsec-deleting-the-aws-variables">Deleting the AWS_* variables</a></li>
        <li><a href="#subsec-use-the-verbose-option">Use the '-v' (--verbose) option</a></li>

      </ul>
  </li>

</ul>


<a id="subsec-walkthrough"></a>
<h3>Walkthrough</h3>

<p>Once installed, <strong>'<code>aws-as</code>'</strong> and friends
are used as follows.</p>

<p>You start by <strong>"activating"</strong> the tools in your current
shell process, like this:</p>
<pre>
    $ <strong>eval "$(aws-as-activate -s)"</strong>
    (_) $
</pre>
<p><em>[The changed prompt
is <a href="#explanation-ps1-prompt">explained further down
below</a>.]</em></p>

<div class="logical-paragraph">
<p>
That "activation" makes three commands available in your current shell
environment:</p>
<ul>
  <li><strong><code>aws-as-deactivate</code></strong></li>
  <li><strong><code>aws-as</code></strong></li>
  <li><strong><code>aagg</code></strong></li>
</ul>
</div>

<p>All three of the above commands are implemented as bash <em>functions</em>.</p>

<p>The <strong><code>aws-as-deactivate</code></strong> command causes all of the
function code and variables "installed" by the above <code>eval</code> to be deleted
from the shell environment; it basically puts things back to the way they were prior
to the <code>eval</code>. The
<code>AWS_*</code> variables (if any) that had been set in the environment previously
are restored to the state they were found in.</p>

<p>The <strong><code>aws-as</code></strong> command is the tool used to
switch between the credentials associated with different aws-cli
profiles. Examples of basic use follow.</p>

<p>List the aws-cli profiles:</p>
<pre>
    (_) $ <strong>aws-as -L</strong>
    some-prof-name
    some-other-prof-name
    yet-another-prof-name
</pre>
<p>Switch to a given profile:</p>
<pre>
    (_) $ <strong>aws-as some-prof-name</strong>
    (some-prof-name) $
</pre>

<p><a id="explanation-ps1-prompt"></a>Note that the
shell's <strong><code>$PS1</code></strong> setting has been augmented
with the name of the profile whose creds are currently in effect. We
call that profile
<strong>"the in-effect aws-cli profile"</strong>,
or just
<strong>"the in-effect profile"</strong>. The earlier prompt
prefix <strong><tt>"(_)"</tt></strong> indicated that aws-as was active in the
environment, but no profile had been selected to be active. If you change to a
different profile, that other profile will be indicated:</p>
<pre>
    (some-prof-name) $ <strong>aws-as some-other-prof-name</strong>
    (some-other-prof-name) $
</pre>

<p>To go back to <em>not</em> having any profile be active, use
the <strong><code>--none</code></strong> option:</p>
<pre>
    (some-other-prof-name) $ <strong>aws-as --none</strong>
    (_) $
</pre>
<p>or, more conveniently, by specifying <strong>"_"</strong> (a single underscore) as
the name of the profile to switch to:</p>
<pre>
    (some-other-prof-name) $ <strong>aws-as _</strong>
    (_) $
</pre>
<p><strong>The underscore is recognized as meaning "no
profile".</strong> It is also the reason an underscore (as opposed to
some other symbol) is shown in the augmented <code>$PS1</code> prompt
when there is no in-effect profile.
</p>

<p>To have <code>aws-as</code> (and friends) remove themselves entirely from your
shell environment, invoke the <strong>'<code>aws-as-deactivate</code>'</strong>
command:</p>
<pre>
    (_) $ <strong>aws-as-deactivate</strong>
    $
</pre>

<p>At this point you know how to "turn it on" and "turn it off", but to
actually get any real work done you will need to know how to perform
some activity with the in-effect profile, well, in-effect.</p>

<div class="logical-paragraph">
<p>There are two different scenarios to consider:</p>
<ol>
  <li><p>Running some other program
      (e.g., <a href="https://www.terraform.io/">'<code>terraform</code>'</a>)
      as a subprocess using the in-effect profile</p></li>

  <li><p>Performing some activity (e.g., ad hoc scripting) in your
      current shell process using the in-effect profile.</p></li>
</ol>
<p>Here we will consider the first scenario, which is the most common;
it entails use of the <strong>'<code>aagg</code>'</strong> command to
run "the real" program. The second requires a discussion
about <a href="#explanation-hoisting">"hoisting"</a>, which is explained
later on.</p>
</div>

<p>

</p>




<p>Note that the <strong>'<code>aws-as</code>'</strong>
and <strong>'<code>aagg</code>'</strong> commands, though implemented as shell
functions, are intended to "feel like" normal command line programs. Among other
things, they provide meaningful return code (zero for success, non-zero for error) as
an "exit status", and you can ask them for
their <strong>'<code>--version</code>'</strong>:</p>
<pre>
    (_) $ <strong>aws-as --version</strong>
    aws-as 0.2.0  (built: 2020-09-14 15:07:58)
    
    Copyright (C) 2020 Alan D. Salewski <ads@salewski.email>
    License GPLv2+: GNU GPL version 2 or later <http://gnu.org/licenses/gpl.html>.
    This is free software: you are free to change and redistribute it.
    There is NO WARRANTY, to the extent permitted by law.
    
    Written by Alan D. Salewski.
</pre>
<p>and their <strong>'<code>--help</code>'</strong> output...<br>
<strong><code>aws-as</code>:</strong></p>
<pre>
    (_) $ <strong>aws-as --help</strong>
    usage: aws-as [-v...] { -h | --help }
      or:  aws-as [-v...] { -V | --version }
      or:  aws-as [-v...] { -c | --clear-env }
      or:  aws-as [-v...] { -C | --clear-creds }
      or:  aws-as [-v...] { -E | --export }
      or:  aws-as [-v...] { -H | --hoist }
      or:  aws-as [-v...] { -L | --list-profiles }
      or:  aws-as [-v...] { -U | --unexport }
      or:  aws-as [-v...] --generate-config
      or:  aws-as [OPTION...] [--] { AWS_CLI_PROFILE | - }
    
    Switch to using creds from the specified aws-cli profile,
    authenticating with MFA, if necessary.
    
    CAREFUL: Bundling of short-form options is not (yet?) supported.
    
      -h, --help             Print this help message on stdout
      -V, --version          Print the version of the program on stdout
    
      -c, --clear-env        Unset AWS_* credential variables in the current environment
    
      -C, --clear-creds      Clear cached temporary credentials from the aws-vault cache
                               for the in-effect aws-cli profile.
                               Implies -c (--clear-creds) and --none.
    
      -E, --export           Mark the AWS_* credential variables for export
                               Implies -H (--hoist).
    
      -U, --unexport         Un-mark the AWS_* creds vars for export (turn off 'x' attribute)
                               Implies -H (--hoist).
    
      -H, --hoist            "Hoist up" into the current environment AWS_* credential
                               variables associated with the in-effect profile
    
          --generate-config  Print on stdout a default configuration file
    
      -L, --list-profiles    Print list of aws-cli profiles on stdout
    
          --none             Unset the in-effect aws-cli profile
                               Alternatively, can be expressed as AWS_CLI_PROFILE '_'.
    
      -v, --verbose          Print program progress messages on stderr. Specify multiple
                               times to increase verbosity: info, debug, and tracing (set -x)
    
          -                  Switch to previous profile (analogous to 'cd -')
    
          --                 Signals the end of options and disables further options processing.
                               Any remaining argument will be interpreted as teh AWS_CLI_PROFILE.
    
    Report bugs to Alan D. Salewski <ads@salewski.email>.
</pre>
<p><strong><code>aagg</code>:</strong></p>
<pre>
    (_) $ <strong>aagg --help</strong>
    usage: aagg [-v...] { -h | --help }
      or:  aagg [-v...] { -V | --version }
      or:  aagg [OPTION...] [--] COMMAND [ARG...]
    
    Use aws-vault to run (exec) COMMAND in the context of the in-effect
    aws-cli profile, as established by using aws-as(1).
    
    CAREFUL: Bundling of short-form options is not (yet?) supported.
    
      -h, --help     Print this help message on stdout
      -V, --version  Print the version of the program on stdout
    
      -v, --verbose  Print program progress messages on stderr. Specify multiple
                       times to increase verbosity: info, debug, and tracing (set -x)
    
          --         Signals the end of options and disables further options processing.
                       Any remaining argument will be interpreted as the COMMAND and its ARGs.
    
    Report bugs to Alan D. Salewski <ads@salewski.email>.
</pre>

<a id="subsec-aws-profile-is-not-used"></a>
<h3>AWS_PROFILE is not used</h3>

<p>Note that the notion of the "in-effect aws-cli profile" is similar to what is
meant when somebody sets the <strong><code>AWS_PROFILE</code></strong> in their
environment, but know that <strong>'<code>aws-as</code>'</strong>
and <strong>'<code>aagg</code>'</strong> do not use that variable. The way that
the <code>aws-as</code> tools track the in-effect profile is an internal
implementation detail, and is not at all influenced by <code>AWS_PROFILE</code>.</p>

<p>At activation time, if an <code>AWS_PROFILE</code> env var is found to be set in
the current shell environment, it's original value is "remembered" (so it can be
restored at deactivation time) and the <code>AWS_PROFILE</code> variable is then
unset. The variables is otherwise unused.</p>

<p>The reason to unset <code>AWS_PROFILE</code> at activation time is to avoid
unwanted interactions with other <code>'AWS_*'</code> variables (e.g., in the
precedence rules implemented by programs that are influenced by
the <code>'AWS_*'</code> variables) that would get loaded if the user were to use the
<strong>"hoist"</strong> feature described next.</p>


<a id="subsec-no-aws-variables-are-set-by-default"></a>
<h3>No <code>AWS_*</code> variables are set (by default)</h3>

<p>By default, no <code>AWS_*</code> variables are set in the current shell environment.</p>


<a id="subsec-how-it-works"></a>
<h4>How it works</h4>

<p>When <strong>'<code>aagg</code>'</strong> is given a user-supplied
command to run, that command will actually be run as a grandchild of the
current shell process. The way it works is that '<code>aagg</code>'
constructs an '<code>aws-vault exec</code>' command line using the
in-effect profile, and just invokes that. The '<code>aws-vault</code>'
program will pull the temporary credentials out of its cache for the
profile, and then use those cached creds to set the '<code>AWS_*</code>'
credential variables
(<code>AWS_ACCESS_KEY_ID</code>, <code>AWS_SECRET_ACCESS_KEY</code>,
and <code>AWS_SESSION_TOKEN</code>) in the environment of the invoked
subprocess.</p>


<a id="subsec-but-aws-vars-in-the-shell-env-can-be-useful">
<h4>"But <code>AWS_*</code> vars in the shell env can be useful..."</h4>

<a id="explanation-hoisting"></a>
<p>Yes, sometimes it is convenient to have the '<code>AWS_*</code>'
credential variables set (and maybe even exported) in the current shell
environment. One such use case is ad hoc scripting that references other
variables in the current shell environment that are not exported, so
would not be available to subprocesses. Rather than export them just for
that purpose, <strong>'<code>aws-as</code>'</strong> provides the
ability to have them "hoisted up" into the current environment.</p>

<p>What we call <strong>"hoisting"</strong> is a way of
obtaining <code>'AWS_*'</code> credential variable settings from a
subprocess and applying them in the context of the current shell
environment. A subprocess, of course, cannot directly affect the
environment of a parent process, but it can describe how to create a
replica of (a subset of) its own settings.</p>

<p>It works like this: <strong>'<code>aws-as</code>'</strong> generates
a small <a href="https://www.gnu.org/software/bash/">bash</a> program
(basically a handful of <strong>'<code>declare -p
AWS_FOO</code>'</strong> statements) and
has <strong>'<code>aws-vault</code>'</strong> run it for the in-effect
profile like any other program.</p>

<p>The effect is that the grandchild process tells the grandparent
process (your current shell process) how to define the
'<code>AWS_*</code>' credential varibles. The output of the grandchild
program is a series of statements (another series
of <code>bash</code> <strong>'<code>declare</code>'</strong> statements)
that are safe to '<code>eval</code>', each one a statement to cause a
given '<code>AWS_FOO</code>' variable to be set with a specific set of
attributes and a value. The
calling <strong>'<code>aws-as</code>'</strong> <em>function</em>
captures that output and
<code>eval</code>'s it in the context of the current shell process.</p>

<p>Here it is in action. To have the variable hoisted-up into the
current shell environment, use
the <strong>'<code>aws-as</code>'</strong> <strong>'<code>-H</code>'</strong>
(<strong>'<code>--hoist</code>'</strong>) option:</p>
<pre>
    (some-prof-name) $ <strong>echo $AWS_ACCESS_KEY_ID</strong>
    # [no output, is not set]

    (some-prof-name) $ <strong>declare -p AWS_ACCESS_KEY_ID</strong>
    bash: declare: AWS_ACCESS_KEY_ID: not found

    (some-prof-name) $ <strong>aws-as --hoist</strong>

    (some-prof-name) $ <strong>echo $AWS_ACCESS_KEY_ID</strong>
    ASIA4SOMERANDOMCHARS
</pre>

<p><em>Voila!</em> The '<code>AWS_*</code>' credential variables appropriate
for the in-effect profiles have been set in your current shell.</p>


<a id="subsec-exporting-the-aws-variables"></a>
<h4>Exporting the AWS_* variables</h4>

<p>The '<code>AWS_*</code>' credential variables are set,
but they are not exported.
To export them,
use the <strong>'<code>-E</code>'</strong>
(<strong><code>--export</code></strong>) option:</p>

<pre>
    # show that the export attribute is not set:
    (some-prof-name) $ <strong>declare -p AWS_ACCESS_KEY_ID</strong>
    declare -- AWS_ACCESS_KEY_ID="ASIA4SOMERANDOMCHARS"

    # request that AWS_* vars be exported
    (some-prof-name) $ <strong>aws-as --export</strong>

    # confirm that the export attribute is now set
    (some-prof-name) $ <strong>declare -p AWS_ACCESS_KEY_ID</strong>
    declare -x AWS_ACCESS_KEY_ID="ASIA4SOMERANDOMCHARS"
</pre>


<a id="subsec-unexporting-the-aws-variables"></a>
<h4>Unxporting the AWS_* variables</h4>

<p>To remove the export attribute from the <code>AWS_*</code> variables,
use the <strong>'<code>-U</code>'</strong>
(<strong><code>--unexport</code></strong>) option:</p>
<pre>
    (some-prof-name) $ <strong>aws-as -U</strong>

    # confirm that the export attribute is no longer set
    (some-prof-name) $ <strong>declare -p AWS_ACCESS_KEY_ID</strong>
    declare -- AWS_ACCESS_KEY_ID="ASIA4SOMERANDOMCHARS"
</pre>


<a id="subsec-deleting-the-aws-variables"></a>
<h4>Deleting the AWS_* variables</h4>

<p>To delete the <code>AWS_*</code> variables from the current shell environment,
use the ("little cee") <strong>'<code>-c</code>'</strong>
(<strong><code>--clear-env</code></strong>) option:</p>
<pre>
    (some-prof-name) $ <strong>aws-as -v --clear-env</strong>
    aws-as (info): unsetting env var: AWS_ACCESS_KEY_ID
    aws-as (info): unsetting env var: AWS_SECRET_ACCESS_KEY
    aws-as (info): unsetting env var: AWS_SESSION_TOKEN

    (some-prof-name) $ <strong>echo $AWS_ACCESS_KEY_ID</strong>
    # [no output]

    (some-prof-name) $ <strong>declare -p AWS_ACCESS_KEY_ID</strong>
    bash: declare: AWS_ACCESS_KEY_ID: not found
</pre>

<p>To delete the <code>AWS_*</code> variables from the current shell
environment
<strong><em>and</em></strong> request
that <strong>'<code>aws-vault</code>'</strong> clear those temporary
credentials from its cache,
use the ("capital cee") <strong>'<code>-C</code>'</strong>
(<strong><code>--clear-creds</code></strong>) option.
(Note that clearing the credentials from the memory and
the <code>aws-vault</code> cache <em>does not</em> change the in-effect
profile.)
Here we also use the <strong>'<code>-v</code>'</strong>
(<strong><code>--verbose</code></strong>) option to request that the tool emit
additional information about what it is doing:</p>

<pre>
    (some-prof-name) $ <strong>aws-as --verbose --clear-creds</strong>
    aws-as (info): unsetting env var: AWS_ACCESS_KEY_ID
    aws-as (info): unsetting env var: AWS_SECRET_ACCESS_KEY
    aws-as (info): unsetting env var: AWS_SESSION_TOKEN
    aws-as (info): requesting that aws-vault clear cached creds for profile: some-prof-name
    Cleared 1 sessions.
    (some-prof-name) $
</pre>


<a id="subsec-use-the-verbose-option"></a>
<h4>Use the '-v' (--verbose) option</h4>

<p>In general, to have the commands report what they are doing,
use the <strong><code>-v</code></strong> (<strong><code>--verbose</code></strong>) option.
You can specify <code>-v</code> more than once;
each additional <code>-v</code>
(up to three)
increases the output verbosity.
One <strong><code>-v</code></strong> opt turns on "info-level" output.
Two <strong><code>-v</code></strong> opts turns on "debug-level" output.
Three <code>-v</code> options cause tracing (<code>set -x</code>)
to be enabled
within the context of the <code>aws-as</code> or <code>aagg</code> operation.
</p>


<h2><a id="sec-faq">FAQ</a></h2>

<div class="logical-paragraph">
<p>Frequently asked questions (with answers!):</p>
<ul>
  <li><p><a id="faq-impl-as-bash-functions"></a><strong>Q: Why are the commands implemented as bash functions?</strong></p>

      <p><strong>A: There are three reasons:</strong></p>

      <ol>

        <li><p><em><code>$PS1</code> augmentation.</em> We desire to
            augment the <strong><code>$PS1</code></strong> shell prompt
            with "the in-effect profile" without requiring the user to
            futz with the bash <code>PROMPT_COMMAND</code> (or the
            equivalent in other shells). This requires the ability to
            (carefully!) augment the value of <code>$PS1</code>
            directly. Like the "virtual env" feature provided by the
            Python
            3 <a href="https://docs.python.org/3/library/venv.html"
            alt="Python 3 venv module page">'<code>venv</code>'</a>
            module (and similarly behaved tools), the user should see
            regular feedback about when the feature is active.</p></li>

        <li><p><em>Ad hoc scripting.</em> Even though it is generally
            safer to <em>avoid</em> having the '<code>AWS_*</code>'
            credential variables defined in your interactive shell
            environment, there are situations in which doing so is both
            safe and useful, as discussed above
            in <a href="#explanation-hoisting">our explanation of
            "hoisting"</a>. This requires access to the current shell
            environment.</p></li>

        <li><p><em>History.</em> The original motivation for
            implementing <strong>'<code>aws-as</code>'</strong> was to
            manipulate the current shell environment.</p>

            <p>Additional background: The original implementation of
            the <strong>'<code>aws-as</code>'</strong> command was
            motivated by the frustrations involved with repeatedly
            setting up the current shell environment with temporary
            '<code>AWS_*</code>' credential variables using the output
            from the <strong>'<code>aws</code>'</strong> command
            (from <strong><code>aws-cli</code></strong>). Like others,
            the author employed various scripting approaches to this
            problem with different levels of sophistication as needs
            increased. However, none of the solutions used was both
            general <em>and</em> easy to use. They tended to work only
            with a specific set of AWS accounts that happened to be in
            use at the time, or they solved a subset of the problems
            that are now solved more generally
            by <strong>'<code>aws-as</code>'</strong>.</p></li>
      </ol>
    </li>


  <li><p><a id="faq-see-what-will-be-evaled"></a><strong>Q:</strong>I am
      a little uncomfortable '<code>eval</code>'ing anything in my current
      shell. Is there a way to see what is going on?</p></li>

      <p><strong>A:</strong> Sure: you can examine the output
      of <strong>'<code>aws-as-activate -s</code>'</strong> in
      your <code>$PAGER</code> without '<code>eval</code>'ing it:</p>
      <pre>
    $ <strong>aws-as-activate -s | less -N</strong>
      </pre>

      <p>You can even save it to a temporary file, and only source that
      (instead of directly sourcing the output
      of <strong>'<code>aws-as-activate -s</code>'</strong>) once you
      are satisfied that doing so is safe:</p>
      <pre>
    $ <strong>aws-as-activate -s | tee /tmp/to-activate.bash | less -N</strong>
    # [review happens here]

    # [once satisfied, you can source the copy saved by tee]
    $ <strong>source /tmp/to-activate.bash</strong>
    (_) $
      </pre></li>


  <li><p><a id="faq-name-aws-as"></a><strong>Q: Where does the name 'aws-as' come from?</strong></p>

      <p><strong>A:</strong> The
      name <strong>'<code>aws-as</code>'</strong> comes from the
      original purpose of the program: to use the AWS APIs <em>as</em>
      the actor (IAM User or Role) implied by the
      in-effect <code>aws-cli</code> profile.</p>

      <p>"Now I'm working <em>as</em> Foo."<br>
         "Now I'm working <em>as</em> Bar."<br>
         "Now I'm back to Foo."<br>
         <em>And so on...</em></p></li>


  <li><p><a id="faq-name-aagg"></a><strong>Q: Where does the name 'aagg' come from?</strong></p>

      <p><strong>A:</strong> The short answer is: It was easy to type quickly.</p>

      <p>The name 'aagg' is an
         <a alt="initialysm (definition)"
            href="https://salewski.github.io/2020/09/17/word-def-initialysm.html">initialysm</a>
         (not to be mistaken for an <em>initialism</em> or for a
         <em>backronym</em>, though those are related terms).
         The original comment in the source code sums it up this way:</p>
      <pre>
    # aagg == (A)WS-(a)-(g)o-(g)o
    # Read as: "AWS-a-go-go"
    # Dumb name; is easy to type; is grep-friendly.
</pre></li>

</ul>
</div>

<!--
<h2><a id="sec-aws-vault-quickstart"><code>aws-vault</code> quickstart</a></h2>


<p><strong style="color:red;">
FIXME: document aws-vault quickstart
</strong></p>
-->


<h2><a id="sec-license">License</a></h2>

<p>
Unless otherwise stated by a different license notice in a particular file,
all files in the `aws-as' project are made available under the GNU
GPL version 2, or (at your option) any later version.
</p>


<pre>
    GPLv2+: GNU GPL version 2 or later &lt;http://gnu.org/licenses/gpl.html&gt;
</pre>


<p>
See the <a href="https://github.com/salewski/aws-as/blob/master/COPYING">COPYING</a> file for the full license.
</p>

<pre>
    Copyright (C) 2020 Alan D. Salewski &lt;ads@salewski.email&gt;

        This program is free software; you can redistribute it and/or modify
        it under the terms of the GNU General Public License as published by
        the Free Software Foundation; either version 2 of the License, or
        (at your option) any later version.

        This program is distributed in the hope that it will be useful,
        but WITHOUT ANY WARRANTY; without even the implied warranty of
        MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
        GNU General Public License for more details.

        You should have received a copy of the GNU General Public License along
        with this program; if not, write to the Free Software Foundation, Inc.,
        51 Franklin Street, Fifth Floor, Boston, MA 02110-1301 USA.
</pre>


<h3><a id="authors-and-contributors" class="anchor" href="#authors-and-contributors" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Authors and Contributors</h3>

<p>The <code>aws-as</code> project code was written by <a href="https://github.com/salewski" class="user-mention">Alan D. Salewski</a>.</p>

<p>The <a href="https://github.com/">GitHub</a> project page is located at:</p>
<ul>
    <li><a href="https://github.com/salewski/aws-as">https://github.com/salewski/aws-as</a></li>
</ul>



<!-- FIXME: add note and link to 'BUGS' file here -->

      </section>

      <footer>
        <h3><a id="support-or-contact" class="anchor" href="#support-or-contact" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Support or Contact</h3>
        <p>This project page is maintained (barely!) by <a href="https://github.com/salewski">Alan D. Salewski</a></p>
        <p><small>Hosted on GitHub Pages &mdash; Theme by <a href="https://github.com/orderedlist">orderedlist</a></small></p>
      </footer>
    </div>
    <script src="javascripts/scale.fix.js"></script>
    
  </body>
</html>
